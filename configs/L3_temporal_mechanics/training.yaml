# Level 3: Temporal Mechanics
#
# See docs/TRAINING_LEVELS.md for complete specification.
#
# Key features (adds to Level 2):
# - 24-tick day/night cycle with operating hours
# - Multi-tick interactions (progressive benefits + completion bonuses)
# - Time-based action masking (affordances have business hours)
# - Temporal planning and opportunity cost learning
# - LSTM learns time-dependent strategies

run_metadata:
  output_subdir: L3_temporal_mechanics

# Environment configuration
environment:
  partial_observability: true
  vision_range: 2
  enabled_affordances: null  # null = all 14 affordances enabled
  randomize_affordances: true

  # NEW: Temporal mechanics
  enable_temporal_mechanics: true
  energy_move_depletion: 0.005
  energy_wait_depletion: 0.001
  energy_interact_depletion: 0.0

# Network architecture is managed by brain.yaml:architecture.type
# ("feedforward" → SimpleQNetwork, "recurrent" → RecurrentSpatialQNetwork)
population:
  num_agents: 1
  mask_unused_obs: false  # Don't mask observations (standard behavior)

# Curriculum configuration
curriculum:
  max_steps_per_episode: 500
  survival_advance_threshold: 0.7
  survival_retreat_threshold: 0.3
  entropy_gate: 0.5
  min_steps_at_stage: 1000

# Exploration configuration
exploration:
  embed_dim: 128
  initial_intrinsic_weight: 1.0
  variance_threshold: 100.0
  min_survival_fraction: 0.4  # Don't anneal until mean survival >40% of max episode length (prevents "stable failure")
  survival_window: 100
  epsilon_start: 1.0
  epsilon_min: 0.01
  epsilon_decay: 0.999

# Training configuration
training:
  device: cuda
  max_episodes: 10000  # Total episodes for this training run

  # Q-learning hyperparameters
  train_frequency: 4  # Train Q-network every N steps
  batch_size: 16  # Smaller batch for LSTM (recurrent: 16, feedforward: 64)
  sequence_length: 8  # Length of sequences for LSTM training
  max_grad_norm: 10.0  # Gradient clipping threshold

  # Epsilon-greedy exploration (moderate decay)
  epsilon_start: 1.0  # Initial exploration rate
  epsilon_decay: 0.995  # Moderate decay for temporal mechanics
  epsilon_min: 0.01  # Minimum exploration rate
