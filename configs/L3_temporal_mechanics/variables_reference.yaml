# TEMPORARY REFERENCE VARIABLES (Cycle 0.2)
# Config: L3_temporal_mechanics (8×8 Grid2D, POMDP mode, temporal mechanics enabled)
# Expected observation_dim: 54 (25 window + 2 position + 8 meters + 15 affordance + 4 temporal)

version: "1.0"

variables:
  # POMDP local window: 25 cells (5×5)
  - {id: "local_window", scope: "agent", type: "vecNf", dims: 25, lifetime: "tick", readable_by: ["agent"], writable_by: ["engine"], default: [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}

  # Full observability grid encoding: 64 cells (8×8) - NOT used in POMDP mode
  # NOTE: Not readable by agent in L3 (POMDP mode), only readable by engine for internal use
  - id: "grid_encoding"
    scope: "agent"
    type: "vecNf"  # N-dimensional float vector
    dims: 64
    lifetime: "tick"  # Derived from current position
    readable_by: ["engine"]
    writable_by: ["engine"]
    default: [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]
    description: "8×8 grid encoding (0=empty, 1=agent, 2=affordance, 3=both)"

  # Normalized position: 2 dims
  - id: "position"
    scope: "agent"
    type: "vecNf"  # N-dimensional float vector (normalized position)
    dims: 2
    lifetime: "episode"  # Persistent position
    readable_by: ["agent", "engine", "acs"]
    writable_by: ["actions", "engine"]
    default: [0.0, 0.0]
    description: "Normalized agent position (x, y) in [0, 1] range"

  # ========================================
  # METERS (8 dims)
  # ========================================

  - id: "energy"
    scope: "agent"
    type: "scalar"
    lifetime: "episode"
    readable_by: ["agent", "engine", "acs"]
    writable_by: ["actions", "engine"]
    default: 1.0
    description: "Energy level [0.0-1.0]"

  - id: "health"
    scope: "agent"
    type: "scalar"
    lifetime: "episode"
    readable_by: ["agent", "engine", "acs"]
    writable_by: ["actions", "engine"]
    default: 1.0
    description: "Health level [0.0-1.0]"

  - id: "satiation"
    scope: "agent"
    type: "scalar"
    lifetime: "episode"
    readable_by: ["agent", "engine", "acs"]
    writable_by: ["actions", "engine"]
    default: 1.0
    description: "Satiation (food) level [0.0-1.0]"

  - id: "money"
    scope: "agent"
    type: "scalar"
    lifetime: "episode"
    readable_by: ["agent", "engine", "acs"]
    writable_by: ["actions", "engine"]
    default: 0.0
    description: "Money accumulated"

  - id: "mood"
    scope: "agent"
    type: "scalar"
    lifetime: "episode"
    readable_by: ["agent", "engine", "acs"]
    writable_by: ["actions", "engine"]
    default: 1.0
    description: "Mood level [0.0-1.0]"

  - id: "social"
    scope: "agent"
    type: "scalar"
    lifetime: "episode"
    readable_by: ["agent", "engine", "acs"]
    writable_by: ["actions", "engine"]
    default: 1.0
    description: "Social satisfaction [0.0-1.0]"

  - id: "fitness"
    scope: "agent"
    type: "scalar"
    lifetime: "episode"
    readable_by: ["agent", "engine", "acs"]
    writable_by: ["actions", "engine"]
    default: 1.0
    description: "Fitness level [0.0-1.0]"

  - id: "hygiene"
    scope: "agent"
    type: "scalar"
    lifetime: "episode"
    readable_by: ["agent", "engine", "acs"]
    writable_by: ["actions", "engine"]
    default: 1.0
    description: "Hygiene level [0.0-1.0]"

  # ========================================
  # AFFORDANCE AT POSITION (15 dims)
  # ========================================
  # Phase 1: Use fixed-size vector for one-hot encoding

  - id: "affordance_at_position"
    scope: "agent"
    type: "vecNf"  # N-dimensional float vector (one-hot encoding)
    dims: 15
    lifetime: "tick"  # Derived from current position
    readable_by: ["agent", "engine"]
    writable_by: ["engine"]
    default: [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0]
    description: "One-hot affordance type at agent position (14 types + none)"

  # ========================================
  # TEMPORAL FEATURES (4 dims)
  # ========================================

  - id: "time_sin"
    scope: "global"
    type: "scalar"
    lifetime: "tick"  # Derived from current time
    readable_by: ["agent", "engine"]
    writable_by: ["engine"]
    default: 0.0
    description: "sin(2π * time_of_day / 24) for cyclical time encoding"

  - id: "time_cos"
    scope: "global"
    type: "scalar"
    lifetime: "tick"  # Derived from current time
    readable_by: ["agent", "engine"]
    writable_by: ["engine"]
    default: 1.0
    description: "cos(2π * time_of_day / 24) for cyclical time encoding"

  - id: "interaction_progress"
    scope: "agent"
    type: "scalar"
    lifetime: "tick"  # Resets per interaction
    readable_by: ["agent", "engine"]
    writable_by: ["engine"]
    default: 0.0
    description: "Normalized interaction progress [0-1] (ticks completed / required)"

  - id: "lifetime_progress"
    scope: "agent"
    type: "scalar"
    lifetime: "episode"  # Increases over agent lifetime
    readable_by: ["agent", "engine"]
    writable_by: ["engine"]
    default: 0.0
    description: "Normalized lifetime progress [0-1] (0=birth, 1=retirement)"

# ========================================
# EXPOSED OBSERVATIONS
# ========================================
# These map variables to observation fields for BAC compiler

exposed_observations:
  - {id: "obs_local_window", source_variable: "local_window", exposed_to: ["agent"], shape: [25]}
  # NOTE: obs_grid_encoding not exposed for POMDP mode (L3 always uses partial_observability=true)

  - id: "obs_position"
    source_variable: "position"
    exposed_to: ["agent"]
    shape: [2]
    normalization:
      kind: "minmax"
      min: [0.0, 0.0]
      max: [1.0, 1.0]

  - id: "obs_energy"
    source_variable: "energy"
    exposed_to: ["agent"]
    shape: []
    normalization:
      kind: "minmax"
      min: 0.0
      max: 1.0

  - id: "obs_health"
    source_variable: "health"
    exposed_to: ["agent"]
    shape: []
    normalization:
      kind: "minmax"
      min: 0.0
      max: 1.0

  - id: "obs_satiation"
    source_variable: "satiation"
    exposed_to: ["agent"]
    shape: []
    normalization:
      kind: "minmax"
      min: 0.0
      max: 1.0

  - id: "obs_money"
    source_variable: "money"
    exposed_to: ["agent"]
    shape: []
    normalization: null  # Money unbounded

  - id: "obs_mood"
    source_variable: "mood"
    exposed_to: ["agent"]
    shape: []
    normalization:
      kind: "minmax"
      min: 0.0
      max: 1.0

  - id: "obs_social"
    source_variable: "social"
    exposed_to: ["agent"]
    shape: []
    normalization:
      kind: "minmax"
      min: 0.0
      max: 1.0

  - id: "obs_fitness"
    source_variable: "fitness"
    exposed_to: ["agent"]
    shape: []
    normalization:
      kind: "minmax"
      min: 0.0
      max: 1.0

  - id: "obs_hygiene"
    source_variable: "hygiene"
    exposed_to: ["agent"]
    shape: []
    normalization:
      kind: "minmax"
      min: 0.0
      max: 1.0

  - id: "obs_affordance_at_position"
    source_variable: "affordance_at_position"
    exposed_to: ["agent"]
    shape: [15]
    normalization: null  # One-hot, already [0, 1]

  - id: "obs_time_sin"
    source_variable: "time_sin"
    exposed_to: ["agent"]
    shape: []
    normalization: null  # Already in [-1, 1]

  - id: "obs_time_cos"
    source_variable: "time_cos"
    exposed_to: ["agent"]
    shape: []
    normalization: null  # Already in [-1, 1]

  - id: "obs_interaction_progress"
    source_variable: "interaction_progress"
    exposed_to: ["agent"]
    shape: []
    normalization:
      kind: "minmax"
      min: 0.0
      max: 1.0

  - id: "obs_lifetime_progress"
    source_variable: "lifetime_progress"
    exposed_to: ["agent"]
    shape: []
    normalization:
      kind: "minmax"
      min: 0.0
      max: 1.0

# ========================================
# DIMENSION VALIDATION
# ========================================
# Total observation dimensions: 25 + 2 + 8 + 15 + 4 = 54
# - Local window: 25 dims (5×5 POMDP window)
# - Position: 2 dims
# - Meters: 8 dims (8 scalars × 1)
# - Affordance: 15 dims
# - Temporal: 4 dims (4 scalars × 1)
